---
title: 精通比特币读书笔记
date: 2018-03-11 15:28:10
tags:
- 区块链
- 比特币
---
## 第一章 介绍 ##

传统货币的防止双花，必须在一个中心化（centralized）的清算所（clearing house）里清算。比特币则用全局选举的机制达到共识，来清算双花问题。本质上来讲，就是把一个固定的中心化的清算过程，用选举的方式转化为无数个去中心化的局部清算过程。这就弥补了在比特币之前出现的数字货币的缺点。 clearing 在比特币网络里就被称作 mining 。

钱包是保存地址和管理密钥的地方。不要害怕公开自己的钱包地址。

全节点可以获取全部的交易信息，也因此可以验证交易，发出交易。硬件钱包是运转在专有硬件上的节点（树莓派？），冷钱包就是纸一类的东西。离线钱包是非常安全的。

## 第二章 比特币原理##

比特币最多可以分割到一亿分之一的大小。

Transaction就像是复式记账法账簿上的行，即每行都有输入和输出。

简单来说，每一笔交易包含一个或多个“输入”，输入是针对一个比特币账号的**提款**（而不是债务）。 这笔交易的另一面，有一个或多个“输出”，被当成信用点数记入到比特币账户中。这些输入和输出的总额（负债和信用）不需要相等。相反，当输出累加略少于输入量时，**两者的差额就代表了一笔隐含的“矿工费”**，这也是将交易放进账 簿的矿工所收集到的一笔小额支付。
![此处输入图片的描述][1]

简而言之，每个交易的输出是下一个交易的输入，意味着交易是编号的。

![交易是被编号的输入输出][2]

比特币中的找零（change），是经常会被发送到钱包的新地址里（出于隐私原因），或者返回原地址（出于默认配置）。

化零为整的例子：

![此处输入图片的描述][3]

化整为零的例子（发工资）：

![此处输入图片的描述][4]

钱包可以离线生成transaction。

> Alice只需要指定目标地址和金额，其余的 细节钱包应用会在后台自动完成。很重要的一点是，钱包应用甚至可以在完全离线时建立交易。就像在家里写张支票， 之后放到信封发给银行一样，比特币交易建立和签名时不用连接比特币网络。只有在执行交易时才需要将交易发送到网络。

钱包只存储与本地址相关 transaction，是所有数据的子集，是 filtered 过的。

> 大多数钱包应用跟踪着钱包中某个地址的所有可用输出。

查询某个地址的 UTXO，可以看到transaction 的格式，注意看，value的单位是聪（和以太坊一样，以太坊的value最小单位是伟）：

```
curl https://blockchain.info/unspent?active=1Cdid9KFAaatwczBwBttQcwXYCpvK8h7FK
{
"unspent_outputs":[
{
"tx_hash":"186f9f998a5...2836dd734d2804fe65fa35779",
"tx_index":104810202,
"tx_output_n": 0,
"script":"76a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac",
"value": 10000000,
"value_hex": "00989680", 
"confirmations":0
}
]
}
```
这个格式里的 script就是锁定这个 UTXO的关键。这是一个留给未来使用这个UTXO的使用者的谜题-谁能拿出一个signature，可以和这个script里提供的锁定地址（也就是交易里的价值获得者）相匹配，就可以得到使用这个UTXO的权力。但这个script字段是什么意思呢？

value_hex 是 value 的16进制值。

私钥可以产生公钥，公钥可以散列出地址。交易里应该同时存在地址、签名和公钥。

> 交易被包在一起放进区块中时需要极大的计算量来证明，但只需少量计算 就能验证它们已被证明。

> 挖矿在构建区块时会创造新的比特币，和一个中央银行印发新的纸币很类似。

> 描述挖矿的一个好方法是将之类比为一个巨大的多人数独谜题游戏。一旦有人发现正解之后，这个数独游戏会自动调整 困难度以使游戏每次需要大约10分钟解决。想象一个有几千行几千列的巨大数独游戏。如果给你一个已经完成的数独， 你可以很快地验证它。然而，如果这个数独只有几个方格里有数字其余方格都为空的话，就会花费非常长的时间来解 决。这个数独游戏的困难度可以通过改变其大小（更多或更少行列）来调整，但即使它非常大时验证它也是相当容易 的。而比特币中的 "谜题" 是基于哈希加密算法的，其展现了相似的特性：非对称地，它解起来困难而验证很容易，并且它的困难度可以调整。

> 新交易不断地从用户钱包和应用流入比特币网络。当比特币网络上 的节点看到这些交易时，**会先将它们放到各自节点维护的一个临时的未经验证的交易池中**。。当矿工构建一个新区块时， 会将这些交易从这个交易池中拿出来放到这个新区块中，然后通过尝试解决一个非常困难的问题（也叫工作量证明）以 证明这个新区块的合法性。

工作量证明是为了证明这个区块是合法的。

>这些交易被加进新区块时，以交易费用高的优先以及其它的一些规则进行排序。矿工一旦从网络上收到一个新区块时， 会意识到在这个区块上的解题竞赛已经输掉了，会马上开始下一个新区块的挖掘工作。它会立刻将一些交易和这个新区块的数字指纹放在一起开始构建下一个新区块，并开始给它计算工作量证明。每个矿工会在他的区块中包含一个特殊的交易，将新生成的比特币（当前每区块为12.5比特币）作为报酬支付到他自己的比特币地址，再加上块中所有交易的交易费用的总和作为自己的报酬。如果他找到了使得新区块有效的解法，他就会得到这笔报酬，因为这个新区块被加入到了总区块链中，他添加的这笔报酬交易也会变成可消费的。

手续费（fee）的排序是存在的。

> Alice的交易被网络拿到后放进未验证交易池中。一旦被挖矿软件验证，它就被包含在由Jing的采矿池生成的新块（称为候选块）中。 参与该采矿池的所有矿工立即开始计算候选块的工作证明。大约 在Alice的钱包第一次将这个交易发送出来五分钟后，Jing的ASIC矿机发现了新区块的正解并将这个新区块发布到网络上后，一旦被其它矿机验证，它们就会立即投身到构建新区块的竞赛中。

所谓的候选区块也是存在的。

> 全索引客户端可以追钱款的来 源，从第一次有比特币在区块里生成的那一刻开始，按交易与交易间的关系顺藤摸瓜，直到Bob的交易地址。

特别地，轻客户端通过确认交易在哪个区块，以及后面还有多少个区块来确认一个**支付**的合法性。




  [1]: https://github.com/bitcoinbook/bitcoinbook/raw/develop/images/mbc2_0203.png
  [2]: https://github.com/bitcoinbook/bitcoinbook/raw/develop/images/mbc2_0204.png
  [3]: https://github.com/bitcoinbook/bitcoinbook/raw/develop/images/mbc2_0206.png
  [4]: https://github.com/bitcoinbook/bitcoinbook/raw/develop/images/mbc2_0207.png

