---
title: OOM 调查使用到的工具
date: 2018-09-10 11:33:04
tags:
- JVM
- 操作系统
---
1 top 与 htop。这两个东西比 free 好用。比较神奇的是，为什么线上还有装了 htop这样的非标准 top。

2 pmap。这个东西是莫枢自己也用来 dump 详细的内存轮廓的地址，但可能需要使用他提到的一个 Serviceability Agent API 来读才读得懂。这个工具的输出可以看到各段内存的起止，但不经帮助，很难读出各个子线程的栈来。

3 smem。这个东西对内存的 RSS/PSS/USS 分析得很好。但并不能帮助我们直接获知我们最期待的栈内存轮廓，比如当前 JVM 的 stack 到底是怎么分布的，占了多少内存？而且更重要是，线上机器没有这个工具。

4 直接 cat /proc/pid/smaps 其实其他的进程内存查看工具的信息可能都能在这里看得到，但是需要耐心。而且，这个东西在线上也是看不了的，看来也是需要 root。

5 ps_mem.py 这是一个对 private ram usage 分析得不错的脚本。但是需要 root。

6 jstack。 这是目前 thread dump 最详尽的命令行工具了。但线上用不了。

7 其他 jmx 客户端。 JConsole/JVisualVM/JMC。全部都连不上线上。

8 飞行记录器。这个东西甲骨文收费非常贵，但好处是可以录下来再在本地回放。目前看来，所有的 JVM 运行时状态分析，只有这个是最完备的了。它还有一个命令行工具 jcmd，可以动态地使用飞行记录器的功能和各种 jmx client 特有的动能。

9 其他，这里有本[书][1]，讲了很多 system tuning 的原理和工具，但对 JVM 的调试好像没有什么特别的好处。


  [1]: https://www.safaribooksonline.com/library/view/system-performance-tuning/059600284X/ch04.html