---
title: 结算问题
date: 2021-04-12 20:23:12
tags:
- 金融
---
# 结算的业务场景

支持费用结算、佣金和分润。

尽量在结算周期里实现自动结算，提高资金效率。

有结算平台可以实现结算单据。

100%线上化，支持财务运营线上化，符合监管要求。

# 规则分类

- 计费规则
- 出账规则
- 结款规则
- 逾期规则

# 如何设计计费单据

按照结算规则，计费事件至少包括（几种佣金率、结算涉及的主体、业务线、相关公司、周期、商品品类、基本事件金额）。

结算规则要包括：周期、费率、账号、预期规则。
不同的结算会产生不同的单据：
- 分润
- 分佣
- 各种业务单据：保费、理赔

如果有可能，在一个事务里面生成这些单据，正逆向流程都批量处理。

# 规则

规则要可配，可审批，要能够根据时间生效，自动切换。

# 计费量切换

注意按照时间、业务类型进行切换。

# 工作流程

1. 结算事实获取
2. 规则配置和获取
3. 根据规则拆分计费项（**清分计费**）
4. 按周期生成结算单：如果需要线上付款，需要确认是否需要审批后发出结算指令，不同的计费项要有不同的汇总维度，汇总出结算单-账单的一种。
5. 在财务运营平台对账审批后打款-这要关注这个单据的这些状态，和使用的。
6. 有必要的话，打款要触发开发票（开发票不一定可逆，这是结算的一个风险点）。

# 结算

1. 组装基础流水数据
2. 确认是否需要汇总-需要汇总需要在事务里另产生汇总流水。
3. 由下游支付还是本地支付-注意打标。
4. 按照标记确认是否推送下游支付平台。
5. 流水入库-推送和入库实际上是个事务性消息问题，如果没有事务性消息支持，先发送再入库也可以，否则入库可以自己做个任务表驱动发送消息。

