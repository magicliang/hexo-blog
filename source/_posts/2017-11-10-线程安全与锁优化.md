---
title: 线程安全与锁优化
date: 2017-11-10 19:51:43
tags:
- JVM
- 多线程
---

&emsp;&emsp;“当多个线程访问一个对象时，如果不用考虑这些线程在运行时环境下的调度和交替执行，也不需要进行额外的同步，或者在调用方法进行任何其他的协调操作，调用这个对象的行为都可以获得正确的结果，那么这个对象就是线程安全的。”

&emsp;&emsp;相对的线程安全，可以分成五个等级：

## 不可变 ##
    
&emsp;&emsp;不可变的数据，都是线程安全的。不可变的对象引用，加上所有field都是不可变的。如果有得选，尽量连方法都是final的。

## 绝对线程安全 ##

&emsp;&emsp;Vector不是线程安全的。它也会出现并发修改时 Out of Range 的异常（注意，不是 ConcurrentModification 的异常）。

## 相对线程安全 ##

&emsp;&emsp;需要保证对这个对象的单独操作是线程安全的，在调用的时候不需要加上额外的保障措施。对于特定顺序的连续操作，就需要额外的同步来保证调用的正确性了。

## 线程兼容 ##

&emsp;&emsp;可以通过特殊手段做到线程安全的普通类，绝大部分类都属于相对线程安全的。

## 线程对立 ##

&emsp;&emsp;线程对立，是不管调用端是否采取了同步措施，都无法在多线程环境中使用的代码。常见的线程对立的操作还有 suspend()，resume()， System.setIn()，System.setOut()和System.runFinalizerOnExit()。