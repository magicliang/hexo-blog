---
title: 数据库选型
date: 2021-03-10 19:59:56
tags:
- 数据库
---
# 业务场景分类讨论

![业务类型分类.jpeg](业务类型分类.jpeg)

## OLTP 类

- 金融账务类：账务、信用
- 交易流水类：订单、运单、交易、支付、物流
- 库存类：库存中心
- IOT 控制类：取餐柜、单车、电单车
- 商品类：商品中心
- 用户/商户信息类：用户商户信息、优惠券、游戏
- ugc：点评评论、弹幕、用户消息

## 近线型

- 近（离线写）-在线读
- 数据中台类：MySQL 多集群汇总存储
- 日志流水类：IOT 上报流水
- 归档存储类：交易流水冷热分离
- 计算辅助类：ETL 过程的中间存储

# 高可用与强一致

MGR 是 Paxos 的一种变种，可以强一致不丢数据。

![数据结构与适用场景.jpeg](数据结构与适用场景.jpeg)

RPO Recovery Point Objective：数据恢复点目标，业务能够容忍的数据丢失量。除了强一致性的共识算法，不能保证 RPO 变 0（半同步还是可能丢失数据）。
RTO Recovery Time Objective：恢复时间目标。业务能够容忍的停止服务的最长时间，即从灾难发生到业务系统恢复服务功能所需要的最短时间周期。

![acid-一致性.jpeg](acid-一致性.jpeg)

不要用冷冰冰的 SLA 来理解数据库的高可用。

基于 dts 的方案，是异步写入，不可能等远端的 ack，所以 rpo 为 0。能不能选用强一致的方案，要看业务的容忍程度。

![单机房架构比较.jpeg](单机房架构比较.jpeg)

Aurora 应该使用数据卷和数据库实例分离的设计，所以不是 shared-nothing 的架构：

> Aurora 共享存储架构使您的数据独立于集群中的数据库实例。例如，您可以快速添加数据库实例，因为 Aurora
> 不会创建表数据的新副本。相反，数据库实例连接到已包含所有数据的共享卷。您可以从集群中删除数据库实例，而无需从集群中删除任何基础数据。仅当您删除整个集群时，Aurora
> 才会删除数据。

# 可扩展性

![可扩展性方案对比.jpeg](可扩展性方案对比.jpeg)

原生分布式的架构扩展最简单。

架构没有银弹，一定会牺牲掉一些完整的 ACID 的特性，比如没有全局二级索引，或者没有全局事务。

# 事务特性

要关注事务的内外一致性。

预聚合的 OLAP 的性能会很好。

![事务特性.jpeg](事务特性.jpeg)

![内外部一致性比较.jpeg](内外部一致性比较.jpeg)

# 表结构变更

![表结构变更.jpg](表结构变更.jpg)

# 在线实时分析

![在线实时分析.jpeg](在线实时分析.jpeg)

# 结论

不同的数据结构和工作模式适应不同的业务场景，不同业务场景的选型意味着要根据领域模型和领域流程做出合理的选择。平衡性最好的选择还是 RDBMS。