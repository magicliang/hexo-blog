---
title: MySQL大表平滑迁移与拆分实战
date: 2021-03-17 19:58:11
tags:
- 数据库
---

# 向外看

- 数据量变化
- 业务形态变化：我们要不断重构数据存储层
- 趋势变化

# 向内看

- 数据增长，某项指标超过某个阈值
- 数据量太大，隐患很高

# 如何消除，支撑业务健康发展

我们可能有各种方案来解决这个问题。只要我们肯侵入代码，数据迁移、校验、流量灰度都可以做同异步切换来实现。

读写旧 -> 读写旧，写新 -> 读旧，读写新 -> 追数据，校验，读写新

# Scale Up Vs Scale Out

要实现弹性伸缩，伸缩以后，数据要重新打散。

# 设计

全流程可以分成组件：

1. 备份重建
2. 增量同步
3. 校验

这里有不同的组件，可以通过编排来满足差异化的需求。

在数据库里面，扩展是一个比较核心的问题。

要注意校验中锁表的颗粒度，有时候要引入区间锁，不要全锁表。
