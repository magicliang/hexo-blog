---
title: 针对风控的性能优化
date: 2021-07-08 10:50:40
tags:
- 性能
---
# 性能优化的目标

1. 提高功能可用性。
2. 提升用户体验（这一点常被人所忽略）。
3. 降低机器成本（这一点也常被人所忽略）。

# 衡量指标

对应目标，主要衡量指标也有三个：

1. 可用性衡量指标：与性能相关的主要是客户端请求超时率。注意，不是服务端的可用性，作为服务提供方，最应该被关注的是服务被调用后，最终是否可用。
2. 用户体验衡量指标：主要看 TP50、TP90、TP99这几个指标。TP999、TP9999属于长尾请求的指标，一般和可用性正相关。对于长尾请求，根据服务量级，不可用请求造成的业务损失来决定是否需要优化，因为长尾请求的根因复杂且多样，解决起来耗费人力。
3. 机器成本衡量指标：单机吞吐量。这里我们一般也只看高峰期压测数据，因为下游不只服务于我们，下游在高峰期也会有性能问题，调用的下游依赖较多时，下游的性能可能会影响上游服务的吞吐。

# 风控系统的一般业务场景

通常每个风控平台都服务于多个业务线。

每个业务线有多个风控场景，一个风控场景包含多条规则，一条规则使用多个参数，部分参数需要实时去调用外部依赖获取。一条流量进入风控平台后，通过已经加载在机器上的配置，并行调用一个或者多个场景，每个场景内并行的调用需要的外部依赖获取规则需要的参数，最后并行的执行规则，返回规则结果。风控平台在执行过程中大量用到并行化处理，并包含大量的IO调用和CPU密集型的规则运算。

# 思维工具箱

[风控性能优化.xmind](风控性能优化.xmind)
![风控性能优化.png](风控性能优化.png)

遇到性能问题，先套用该模板，看看有哪些点疏漏了，没有考虑到。然后对于每个点评估以下三个问题：

1. 是否存在问题？
2. 解决后可观测的指标能提高多少？能维持多久？
3. 解决方案有几种（复杂问题一般都有多种方案，要求自己至少想三个），每种方案耗费的人力成本，优缺点都有哪些？

这三个问题决定了工作优先级，好的优先级可以更快的解决问题，让客户满意，让自己有成就感。


